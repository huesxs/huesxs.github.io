<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Cómo configurar un servidor DHCP" /><meta property="og:locale" content="en" /><meta name="description" content="Índice ¿Qué es el protocolo DHCP? El funcionamiento del protocolo DHCP Métodos de asignación bajo el protocolo DHCP Nuestro servidor DHCP en Ubuntu Introducción Instalación del servidor DHCP Configurar nuestro servidor DHCP Comprobación de la configuración y funcionamiento Conclusión" /><meta property="og:description" content="Índice ¿Qué es el protocolo DHCP? El funcionamiento del protocolo DHCP Métodos de asignación bajo el protocolo DHCP Nuestro servidor DHCP en Ubuntu Introducción Instalación del servidor DHCP Configurar nuestro servidor DHCP Comprobación de la configuración y funcionamiento Conclusión" /><link rel="canonical" href="https://huesxs.github.io/posts/como-configurar-un-servidor-dhcp/" /><meta property="og:url" content="https://huesxs.github.io/posts/como-configurar-un-servidor-dhcp/" /><meta property="og:site_name" content="Huesos" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-07T17:27:30+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Cómo configurar un servidor DHCP" /><meta name="twitter:site" content="@huesos" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-07T17:27:30+01:00","datePublished":"2022-02-07T17:27:30+01:00","description":"Índice ¿Qué es el protocolo DHCP? El funcionamiento del protocolo DHCP Métodos de asignación bajo el protocolo DHCP Nuestro servidor DHCP en Ubuntu Introducción Instalación del servidor DHCP Configurar nuestro servidor DHCP Comprobación de la configuración y funcionamiento Conclusión","headline":"Cómo configurar un servidor DHCP","mainEntityOfPage":{"@type":"WebPage","@id":"https://huesxs.github.io/posts/como-configurar-un-servidor-dhcp/"},"url":"https://huesxs.github.io/posts/como-configurar-un-servidor-dhcp/"}</script><title>Cómo configurar un servidor DHCP | Huesos</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Huesos"><meta name="application-name" content="Huesos"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /avatar.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Huesos</a></div><div class="site-subtitle font-italic">El blog del entusiasta</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/huesxs" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/huesos" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['consultas','huesos.blog'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Cómo configurar un servidor DHCP</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Cómo configurar un servidor DHCP</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/huesos">Álex 'Huesos'</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1644251250" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-02-07 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1764 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><p><strong>Índice</strong><br /></p><ul><li><a href="#qué-es-el-protocolo-dhcp">¿Qué es el protocolo DHCP?</a><ul><li><a href="#el-funcionamiento-del-protocolo-dhcp">El funcionamiento del protocolo DHCP</a><li><a href="#m%C3%A9todos-de-asignaci%C3%B3n-bajo-el-protocolo-dhcp">Métodos de asignación bajo el protocolo DHCP</a></ul><li><a href="#nuestro-servidor-dhcp-en-ubuntu">Nuestro servidor DHCP en Ubuntu</a><ul><li><a href="#introducci%C3%B3n">Introducción</a><li><a href="#instalaci%C3%B3n-del-servidor-dhcp">Instalación del servidor DHCP</a><li><a href="#configurar-nuestro-servidor-dhcp">Configurar nuestro servidor DHCP</a><li><a href="#comprobaci%C3%B3n-de-la-configuraci%C3%B3n-y-funcionamiento">Comprobación de la configuración y funcionamiento</a></ul><li><a href="#conclusi%C3%B3n">Conclusión</a></ul><h1 id="qué-es-el-protocolo-dhcp">¿Qué es el protocolo DHCP?</h1><p>El DHCP (Dynamic Host Configuration Protocol) es un protocolo que admite que un activo conectado a una red se le pueda asignar su propia configuración alojada en un servidor, de ahí, la distinción entre cliente y servidor en cuanto a DHCP se refiere. Todo esto se realiza de forma dinámica, es decir, no tendremos que ajustar ningún tipo de configuración especial de manera manual en los equipos clientes que se incluyan en los ajustes del servidor. Básicamente con fines de simplificación a la hora de administrar la red en cuestión.</p><p><img data-src="/images/dhcp-kekw.jpeg" alt="img-description" data-proofer-ignore> <em>El protocolo DHCP be like… pero bueno, ya tendremos tiempo en indagar DORA</em></p><h2 id="el-funcionamiento-del-protocolo-dhcp"><span class="mr-2">El funcionamiento del protocolo DHCP</span><a href="#el-funcionamiento-del-protocolo-dhcp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Perfecto, aunque ¿cómo lo podríamos definir de forma amena? El DHCP se basa en cuestión de peticiones de cliente a servidor y viceversa, me explico, el servidor cuando está en marcha está a la espera de peticiones de los clientes que constan en su configuración.</p><p>Cuando uno de estos clientes enciende el equipo o pone en marcha su dispositivo <em>y no sabe cuál es su IP</em>, de forma automática envia una petición de tipo <code class="language-plaintext highlighter-rouge">DHCP Discover</code> al servidor que es el encargado de enviar una respuesta de tipo <code class="language-plaintext highlighter-rouge">DHCP Offer</code> por lo que oferta y asigna lo siguiente: la dirección IP, la puerta de enlace (gateway) y los servidores DNS que apliquen.</p><p>De esta forma se establece una comunicación de cliente a servidor (y viceversa), como bien he comentado anteriormente. Por lo tanto, una vez aceptada la respuesta del servidor, el cliente envia de nuevo una respuesta de tipo <code class="language-plaintext highlighter-rouge">DHCP Request</code> asumiendo la configuración ofrecida por el servidor.</p><p>Paralelamente, el servidor, mantiene en su pequeña caché de este servicio y/o protocolo toda una lista de aquellos clientes con las IP asignadas en este <em>challenge</em>, con este fin, evita que se repita el proceso con una <em>doble asignación</em> de IP con otro cliente.</p><p>Si aún así no ha quedado claro, te dejo este esquema que he hecho, el cual me ha costado años de dedicación y 500 horas de cursos de Photoshop CS6:</p><p><img data-src="/images/dhcp_explain.png" alt="img-description" data-proofer-ignore> <em>Comunicación entre cliente y servidor bajo el protocolo DHCP</em></p><ol><li>El cliente enciende su dispositivo y ‘está perdido’ necesita su dirección IP, por lo que hace una petición <code class="language-plaintext highlighter-rouge">DHCP Discover</code> al servidor.<li>El servidor ‘encamina’ al cliente bajo una respuesta <code class="language-plaintext highlighter-rouge">DHCP Offer</code> que incluye su dirección IP, la <em>gateway</em> y los servidores DNS.<li>El cliente acepta la oferta del servidor bajo una petición <code class="language-plaintext highlighter-rouge">DHCP Request</code>, asume la configuración y se le asigna lo anteriormente dicho.<li>El servidor guarda la información del proceso en su caché y <em>recuerda</em> la IP asignada al cliente para futuros <em>challenges</em>.</ol><h2 id="métodos-de-asignación-bajo-el-protocolo-dhcp"><span class="mr-2">Métodos de asignación bajo el protocolo DHCP</span><a href="#métodos-de-asignación-bajo-el-protocolo-dhcp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Tenemos dos tipos distintos de asignación DHCP: el manual y el automático.</p><ul><li><strong>Manual</strong> –&gt; Bajo este método, la dirección IP se asigna en base a la MAC del dispositivo lo cual asegura que una máquina en concreto tenga una IP estática asignada por el mismo servidor DHCP. Por lo que el mismo servidor DHCP siempre estará enviando una configuración estática al cliente dependiendo de su MAC.<li><strong>Automático</strong> –&gt; Esta manera consta en la asignación automática del conjunto de direcciones IP, dependiendo de la manera que vayan enviando las peticiones los clientes expuestos en la configuración DHCP y recibiendo las respuestas por parte del servidor. Se puede bifurcar en dos categorias basadas en el tiempo: un lapso de tiempo fijado o permanente y/e infinito.<ul><li>Tiempo fijado –&gt; Cuando un cliente queda obsoleto o fuera de la red gestionada por el mismo servidor DHCP, la configuración expira y se ‘libera’. ¿Qué quiere decir esto? Básicamente, la dirección IP que tenía fijada este mismo cliente, queda disponible para otros futuros clientes de la red. Por lo que esta IP se agrupa con las demás disponibles para que el mismo servidor pueda ofrecerla. En cambio, si el cliente quiere mantener su misma IP, bajo esta configuración, tiene que ‘renegociar’ con el servidor en el lapso de tiempo ajustado para persistirla.<li>Tiempo infinito –&gt; De forma sencilla, se mantiene de forma permanente la IP asignada por el servidor al cliente.</ul></ul><p><img data-src="/images/manual-auto.jpeg" alt="img-description" data-proofer-ignore> <em>Es algo como así, la verdad…</em></p><h1 id="nuestro-servidor-dhcp-en-ubuntu">Nuestro servidor DHCP en Ubuntu</h1><h2 id="introducción"><span class="mr-2">Introducción</span><a href="#introducción" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Antes de empezar, cabe recalcar que estaré utilizando el siguiente laboratorio para <em>testear</em> y montar nuestro DHCP Server con un cliente Windows:</p><ul><li>Ubuntu Server 20.04.1 LTS (Focal Fossa) [DHCP Server] (*) Ojo, cabe recalcar que las versiones Desktop y Server son ligeramente distintas, te recomiendo <a href="https://www.makeuseof.com/tag/difference-ubuntu-desktop-ubuntu-server/">leer este artículo.</a><li>Windows XP Professional SP2</ul><p>También configuraremos mediante las opciones de red del mismo VirtualBox, una red interna que compartan tanto nuestro Ubuntu Server como el cliente Windows, quedándose así:</p><p><img data-src="/images/ubuntuserver.png" alt="img-description" data-proofer-ignore> <em>Configuración de red de Ubuntu Server</em></p><p><img data-src="/images/windows.png" alt="img-description" data-proofer-ignore> <em>Configuración de red de Windows XP</em></p><h2 id="instalación-del-servidor-dhcp"><span class="mr-2">Instalación del servidor DHCP</span><a href="#instalación-del-servidor-dhcp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>En nuestra máquina con Ubuntu, ejecutaremos la siguiente orden para instalar el <em>package</em> <code class="language-plaintext highlighter-rouge">isc-dhcp-server</code>:</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>isc-dhcp-server
</pre></table></code></div></div><h2 id="configurar-nuestro-servidor-dhcp"><span class="mr-2">Configurar nuestro servidor DHCP</span><a href="#configurar-nuestro-servidor-dhcp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Siendo precavidos, tenemos que tener en cuenta que nuestro fichero de configuración es <code class="language-plaintext highlighter-rouge">/etc/dhcp/dhcpd.conf</code>, por lo que haremos un respaldo:</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo mv</span> /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd_backup.conf
</pre></table></code></div></div><p>Tras hacer este pequeño <em>backup</em> de la configuración inicial, crearemos el archivo de configuración con el mismo nombre y comenzaremos a editar el fichero de configuración con cualquier IDE, yo optaré por <code class="language-plaintext highlighter-rouge">nano</code>:</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo touch</span> /etc/dhcp/dhcpd.conf
<span class="nb">sudo </span>nano /etc/dhcp/dhcpd.conf
</pre></table></code></div></div><p>Una vez abierto, copiaremos el siguiente contenido dentro del archivo de configuración:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>default-lease-time 600<span class="p">;</span>
max-lease-time 7200<span class="p">;</span>
authoritative<span class="p">;</span>
 
subnet 192.168.1.0 netmask 255.255.255.0 <span class="o">{</span>
 range 192.168.1.10 192.168.1.25<span class="p">;</span>
 option routers 192.168.1.254<span class="p">;</span>
 option domain-name-servers 192.168.1.1, 192.168.1.2<span class="p">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Para ser más exhaustivos investigaremos cada opción establecida en el fichero de configuración, para ver qué estamos poniendo:</p><ul><li><code class="language-plaintext highlighter-rouge">default-lease-time</code>: Es el lapso de tiempo de concesión, es decir, el tiempo predefinido a conceder la petición o inicializar el <em>challenge</em> (<code class="language-plaintext highlighter-rouge">DHCP Offer</code>) en caso de que el cliente no indique ningún tiempo predeterminado.<li><code class="language-plaintext highlighter-rouge">max-lease-time</code>: Es el lapso de tiempo máximo de concesión, en este caso está predefinido a 7200 segundos o mejor dicho 2 horas.<li><code class="language-plaintext highlighter-rouge">authoritative</code>: Indica que es el servidor DHCP <em>oficial</em> para la red local, quién tiene la autoridad básicamente.<li>En este caso el servidor está configurado para servir las IP en un rango del 192.168.1.10 al 192.168.1.25, o para simplificar, 15 hosts máximos en nuestra red.<li>El servidor enviará al cliente la información de asignar la IP 192.168.1.254 como su puerta de enlace predeterminada y las IP 192.168.1.1 y 192.168.1.2 como servidores DNS.</ul><p>Una vez definamos esta configuración, tenemos que tener bien en claro que si queremos ajustar una IP estática a nuestro cliente y queremos garantizarla, como bien he explicado antes en los tipos de ajustes DHCP, debemos de utilizar su MAC. Siendo una máquina virtual nuestro cliente Windows, podemos obtener la MAC muy fácil desde la configuración de red del mismo hipervisor, en este caso VirtualBox:</p><p><img data-src="/images/windowsmac.png" alt="img-description" data-proofer-ignore> <em>MAC de nuestro cliente Windows</em></p><p>Ojo con esto último, ya que deberemos de elegir la MAC de la interfaz de red con la cual queramos configurar nuestro servidor DHCP. También es de tener en cuenta el hostname de nuestra máquina cliente ya que configuraremos por cuantos clientes tengamos un bloque distinto en el fichero <code class="language-plaintext highlighter-rouge">/etc/dhcp/dhcpd.conf</code>.</p><p><img data-src="/images/hostname.png" alt="img-description" data-proofer-ignore> <em>Hostname de nuestro cliente Windows (windows)</em></p><p>Avisadas ya estas dos cosillas, podemos meter este bloque debajo de nuestra configuración del servidor DHCP:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>host windows <span class="o">{</span>
 hardware ethernet 08:00:27:a7:60:28<span class="p">;</span>
 fixed-address 192.168.1.10<span class="p">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Explicando cada opción del bloque:</p><ul><li><code class="language-plaintext highlighter-rouge">host</code>: Indicamos el hostname, en este caso <em>windows</em>.<li><code class="language-plaintext highlighter-rouge">hardware ethernet</code>: Indicamos la MAC de la máquina, que hemos sustraido del hipervisor.<li><code class="language-plaintext highlighter-rouge">fixed-address</code>: Ponemos la IP estática a nuestro gusto que servirá el servidor al cliente Windows.</ul><p>Por lo que nuestro fichero de configuración <code class="language-plaintext highlighter-rouge">/etc/dhcp/dhcpd.conf</code> tiene que asemejarse de tal forma:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>default-lease-time 600<span class="p">;</span>
max-lease-time 7200<span class="p">;</span>
authoritative<span class="p">;</span>
 
subnet 192.168.1.0 netmask 255.255.255.0 <span class="o">{</span>
 range 192.168.1.10 192.168.1.25<span class="p">;</span>
 option routers 192.168.1.254<span class="p">;</span>
 option domain-name-servers 192.168.1.1, 192.168.1.2<span class="p">;</span>
<span class="o">}</span>

host windows <span class="o">{</span>
 hardware ethernet 08:00:27:a7:60:28<span class="p">;</span>
 fixed-address 192.168.1.10<span class="p">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Claro que si queremos que la IP se asigne de forma dinámica, podemos omitir los bloques estáticos anteriormente explicados, siempre y cuando se compartan la misma interfaz: tanto el servidor DHCP como el/los cliente/s DHCP. Por lo que se ofrecerá una IP del rango ajustado en la configuración, (x.x.x.10 al x.x.x.25).</p><p>Finalmente, como el protocolo DHCP permite alojar distintas interfaces, podemos definir una interfaz concreta a la escucha, en mi caso será la interfaz que aloje la red interna que hemos creado <code class="language-plaintext highlighter-rouge">intnet</code>.</p><p>En mi equipo servidor (Ubuntu), me indica que la interfaz tiene el nombre de ‘enp0s8’ haciendo uso de <code class="language-plaintext highlighter-rouge">ip a</code>:</p><p><img data-src="/images/interfaz.png" alt="img-description" data-proofer-ignore> <em>Interfaz de la red interna ‘intnet’</em></p><p>Por lo que deberemos de indicarle dicha interfaz en el fichero <code class="language-plaintext highlighter-rouge">/etc/default/isc-dhcp-server</code>:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>nano /etc/default/isc-dhcp-server
</pre></table></code></div></div><p><img data-src="/images/interface.png" alt="img-description" data-proofer-ignore> <em>Establecemos enp0s8 como interfaz a la escucha en el DHCP Server</em></p><p>Tras hacer esto, deberemos de configurar manualmente la IP estática para nuestro servidor DHCP, en la misma configuración de interfaces. Esto podemos hacerlo por GUI o via comando en el fichero <code class="language-plaintext highlighter-rouge">/etc/netplan</code> (en otras distros. se puede llegar al caso de que esté en <code class="language-plaintext highlighter-rouge">/lib/netplan</code>, <code class="language-plaintext highlighter-rouge">/run/netplan</code> e inclusive <code class="language-plaintext highlighter-rouge">/etc/network/interfaces</code>):</p><p><img data-src="/images/serverconf.png" alt="img-description" data-proofer-ignore> <em>Configuración de red en el servidor DHCP</em></p><h2 id="comprobación-de-la-configuración-y-funcionamiento"><span class="mr-2">Comprobación de la configuración y funcionamiento</span><a href="#comprobación-de-la-configuración-y-funcionamiento" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Una vez hecho, reiniciamos el servicio DHCP con la siguiente instrucción y vemos el estado del servicio:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl restart isc-dhcp-server.service
<span class="nb">sudo </span>systemctl status isc-dhcp-server.service
</pre></table></code></div></div><p><img data-src="/images/post.png" alt="img-description" data-proofer-ignore> <em>Estado del servicio isc-dhcp-server.service exitoso</em></p><p>Tras acabar todo esto, se nos queda una cara tal como así:</p><p><img data-src="/images/lol.jpeg" alt="img-description" data-proofer-ignore> <em>Efectivamente, es mi cara ahora mismo tras escribir todo esto</em></p><p>Pero… podemos comprobar que todo ha ido correctamente y efectivamente tanto el servidor Ubuntu se comunica con nuestro cliente y viceversa:</p><p><img data-src="/images/windowsip.png" alt="img-description" data-proofer-ignore> <em>IP asignada por reserva DHCP</em></p><p><img data-src="/images/pingwindows.png" alt="img-description" data-proofer-ignore> <em>Comunicación exitosa de nuestra máquina Windows (cliente) al servidor Ubuntu</em></p><ul><li>Un pequeño <em>disclaimer</em> que hay que señalar: por temas de bloqueo de paquetes ICMP debido al firewall de Windows y su AV, no podremos hacer ping predeterminadamente de un sistema Linux a un Windows. Deberemos de deshabilitar el AV y funcionalidades para evitar el bloqueo ICMP.</ul><h1 id="conclusión">Conclusión</h1><p>Recapitulando todo el <em>post</em>, podemos extraer que es una gran manera de gestionar nuestra red ya sea empresarial o la doméstica si aplica, que nos da un control general sobre los dispositivos conectados (clientes) a nuestro servidor. Como también, podemos realizar diferentes tareas de adminsitración, control y compartición de recursos que pueden aplicar a cualquier máquina-cliente con cualquier tipo de sistema operativo e incluso cualquier dispositivo que tenga conexión a la red.</p><p>– Huesos</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/sysadmin/'>Sysadmin</a>, <a href='/categories/protocolos/'>Protocolos</a>, <a href='/categories/teoria/'>Teoria</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/protocolos/" class="post-tag no-text-decoration" >protocolos</a> <a href="/tags/sysadmin/" class="post-tag no-text-decoration" >sysadmin</a> <a href="/tags/networking/" class="post-tag no-text-decoration" >networking</a> <a href="/tags/teoria/" class="post-tag no-text-decoration" >teoria</a> <a href="/tags/knowledge/" class="post-tag no-text-decoration" >knowledge</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cómo configurar un servidor DHCP - Huesos&amp;url=https://huesxs.github.io/posts/como-configurar-un-servidor-dhcp/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cómo configurar un servidor DHCP - Huesos&amp;u=https://huesxs.github.io/posts/como-configurar-un-servidor-dhcp/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Cómo configurar un servidor DHCP - Huesos&amp;url=https://huesxs.github.io/posts/como-configurar-un-servidor-dhcp/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/knowledge/">knowledge</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/teoria/">teoria</a> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/pivoting/">pivoting</a> <a class="post-tag" href="/tags/protocolos/">protocolos</a> <a class="post-tag" href="/tags/sysadmin/">sysadmin</a> <a class="post-tag" href="/tags/tunnels/">tunnels</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/pivoting-el-arte-de-saltar-por-las-redes/"><div class="card-body"> <em class="timeago small" data-ts="1644150150" > 2022-02-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pivoting, el arte de saltar por las redes</h3><div class="text-muted small"><p> Índice ¿Qué es el Pivoting? Entrando al caso ejemplificado Metodología del pivoting Introducción Enumeración Herramientas Conclusión ¿...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/pivoting-el-arte-de-saltar-por-las-redes/" class="btn btn-outline-primary" prompt="Older"><p>Pivoting, el arte de saltar por las redes</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/huesos">Álex 'Huesos'</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/knowledge/">knowledge</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/teoria/">teoria</a> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/pivoting/">pivoting</a> <a class="post-tag" href="/tags/protocolos/">protocolos</a> <a class="post-tag" href="/tags/sysadmin/">sysadmin</a> <a class="post-tag" href="/tags/tunnels/">tunnels</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
